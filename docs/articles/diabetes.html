<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Diabetes data: heplots and candisc examples • candisc</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Diabetes data: heplots and candisc examples">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">candisc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/diabetes.html">Diabetes data: heplots and candisc examples</a></li>
    <li><a class="dropdown-item" href="../articles/painters.html">Multivariate Visualization of Painters Style</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/friendly/candisc/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Diabetes data: heplots and candisc examples</h1>
                        <h4 data-toc-skip class="author">Michael
Friendly</h4>
            
            <h4 data-toc-skip class="date">2025-11-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/friendly/candisc/blob/HEAD/vignettes/diabetes.Rmd" class="external-link"><code>vignettes/diabetes.Rmd</code></a></small>
      <div class="d-none name"><code>diabetes.Rmd</code></div>
    </div>

    
    
<p>Vignette built using <code>heplots</code>, version 1.7.9,
<code>candisc</code>, version 1.1.0 and <code>car</code>, version
3.1-3.</p>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>Reaven and Miller (1979) examined the relationship among blood
chemistry measures of glucose tolerance and insulin in 145 nonobese
adults. They used the PRIM9 system at the Stanford Linear Accelerator
Center to visualize the data in 3D, and discovered a peculiar pattern
that looked like a large blob with two wings in different
directions.</p>
<p>After further analysis, the subjects were classified as sub-clinical
(chemical) diabetics, overt diabetics and normals. This study was
influential in defining the stages of development of Type 2 diabetes.
Overt diabetes is the most advanced stage, characterized by elevated
fasting blood glucose concentration and classical symptoms. Preceding
overt diabetes is the latent or chemical diabetic stage, with no
symptoms of diabetes but demonstrable abnormality of oral or intravenous
glucose tolerance.</p>
<p>The <code>Diabetes</code> data set is contained in the
<code>heplots</code> package. This vignette uses these data to
illustrate various graphical methods for multivariate linear models. As
we’ll see, the data is peculiar in several respects and a standard
MANOVA is problematic because some assumptions are violated. We treat
this as a learning opportunity, because it allows us to illustrate
several diagnostic plots. Some of the content here serves as an
additional example for a recent paper on visualizing tests for equality
of variance in MANOVA (Friendly &amp; Sigal, 2017).</p>
<div class="section level3">
<h3 id="setting-up">Setting up<a class="anchor" aria-label="anchor" href="#setting-up"></a>
</h3>
<p>Load the required packages and the data</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://friendly.github.io/heplots/" class="external-link">heplots</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/friendly/candisc/" class="external-link">candisc</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/" class="external-link">car</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Diabetes</span>, package<span class="op">=</span><span class="st">"heplots"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">Diabetes</span><span class="op">)</span></span>
<span><span class="co">## 'data.frame':    145 obs. of  6 variables:</span></span>
<span><span class="co">##  $ relwt  : num  0.81 0.95 0.94 1.04 1 0.76 0.91 1.1 0.99 0.78 ...</span></span>
<span><span class="co">##  $ glufast: int  80 97 105 90 90 86 100 85 97 97 ...</span></span>
<span><span class="co">##  $ glutest: int  356 289 319 356 323 381 350 301 379 296 ...</span></span>
<span><span class="co">##  $ instest: int  124 117 143 199 240 157 221 186 142 131 ...</span></span>
<span><span class="co">##  $ sspg   : int  55 76 105 108 143 165 119 105 98 94 ...</span></span>
<span><span class="co">##  $ group  : Factor w/ 3 levels "Normal","Chemical_Diabetic",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span></code></pre></div>
<p>The variables are:</p>
<ul>
<li>
<code>relwt</code>: relative weight, expressed as the ratio of
actual weight to expected weight, given the person’s height</li>
<li>
<code>glufast</code>: fasting plasma glucose level</li>
<li>
<code>glutest</code>: test plasma glucose level, a measure of
glucose intolerance,</li>
<li>
<code>instest</code>: plasma insulin during test, a measure of
insulin response to oral glucose,</li>
<li>
<code>sspg</code>: steady state plasma glucose, a measure of insulin
resistance</li>
<li>
<code>group</code>: diagnostic group</li>
</ul>
<p><code>relwt</code> is not used in this example, but that is not for
any principled reason.</p>
</div>
</div>
<div class="section level2">
<h2 id="data-ellipsoids-and-homogeneity-of-variance">Data ellipsoids and homogeneity of variance<a class="anchor" aria-label="anchor" href="#data-ellipsoids-and-homogeneity-of-variance"></a>
</h2>
<p>We start by plotting covariance ellipses for three of the variables
in the data set. <code><a href="https://friendly.github.io/heplots/reference/covEllipses.html" class="external-link">heplots::covEllipses()</a></code> is similar to
<code><a href="https://rdrr.io/pkg/car/man/Ellipses.html" class="external-link">dataEllipse()</a></code> in the <code>car</code> package, but tuned to
plots designed to assess homogeneity of covariance matrices in MANOVA
designs. It produces a scatterplot matrix of these when the
<code>variables</code> argument is of length &gt; 2.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://friendly.github.io/heplots/reference/covEllipses.html" class="external-link">covEllipses</a></span><span class="op">(</span><span class="va">Diabetes</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="va">Diabetes</span><span class="op">$</span><span class="va">group</span>, </span>
<span>     variables<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>   fill<span class="op">=</span><span class="cn">TRUE</span>, fill.alpha <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>   pooled<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>     col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"darkgreen"</span><span class="op">)</span> </span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="diabetes_files/figure-html/covEllipse-1.png" alt="Plot matrix of data ellipses for diagnostic groups in three main variables of interest in the `Diabetes` dataset." width="480"><p class="caption">
Plot matrix of data ellipses for diagnostic groups in three main
variables of interest in the <code>Diabetes</code> dataset.
</p>
</div>
<p>It is clear from this that there is a problem of heterogeneity of
variance-covariance matrices here. The normal group shows the smallest
variances and the overt diabetic group the largest.</p>
<p>As well, the plot suggests something more interesting about the
difference between the overt and chemical diabetes groups. In the panel
for <code>glufast</code> and <code>glutest</code>, there appears to be a
direct progression from normal to chemical to overt. However, this is
not true in the other panels, where the chemical diabetes group differs
from the normals in one direction, while the overt group differs in a
different direction and has a within-group correlation opposite in sign
to the others.</p>
<p>This can be seen more easily in individual scatterplots, such as that
below (using <code><a href="https://rdrr.io/pkg/car/man/scatterplot.html" class="external-link">car::scatterplot</a></code>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/scatterplot.html" class="external-link">scatterplot</a></span><span class="op">(</span> <span class="va">instest</span> <span class="op">~</span> <span class="va">glutest</span> <span class="op">|</span> <span class="va">group</span>, data<span class="op">=</span><span class="va">Diabetes</span>, </span>
<span>   pch<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">16</span>,<span class="fl">15</span>,<span class="fl">17</span><span class="op">)</span>, </span>
<span>   col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"darkgreen"</span><span class="op">)</span>,</span>
<span>   smooth<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>   grid<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>   legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>coords<span class="op">=</span><span class="st">"topright"</span><span class="op">)</span>, </span>
<span>   lwd<span class="op">=</span><span class="fl">2</span>,</span>
<span>   ellipse<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>levels<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="diabetes_files/figure-html/scatter-1.png" width="480" style="display: block; margin: auto;"></p>
<p>This insight was part of the reason that Reaven and Miller concluded
that chemical diabetes and overt diabetes reflected different disease
regimes, rather than an increasing progression of severity.</p>
<p>As an aside, we note that the differences among the groups can be
readily seen in 3D using <code><a href="https://rdrr.io/pkg/car/man/scatter3d.html" class="external-link">car::scatter3d()</a></code>. In an R console,
the plot can be zoomed and rotated manually or under <code>rgl</code>
controls.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/scatter3d.html" class="external-link">scatter3d</a></span><span class="op">(</span><span class="va">sspg</span> <span class="op">~</span> <span class="va">glutest</span> <span class="op">+</span> <span class="va">instest</span> <span class="op">|</span> <span class="va">group</span>, data<span class="op">=</span><span class="va">Diabetes</span>, </span>
<span>          surface<span class="op">=</span><span class="cn">FALSE</span>,    sphere.size<span class="op">=</span><span class="fl">1.5</span>, ellipsoid<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>          surface.col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"darkgreen"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="diabetes-rgl.png" alt="3D scatterplot of the diabetes data, with 50% data ellipsoids"><div class="figcaption">3D scatterplot of the diabetes data, with 50%
data ellipsoids</div>
</div>
<div class="section level3">
<h3 id="boxs-m-test">Box’s M test<a class="anchor" aria-label="anchor" href="#boxs-m-test"></a>
</h3>
<p>Box’s M test confirms that there is substantial heterogeneity of
covariance matrices. The <code>plot</code> method for the result gives a
convenient and informative display of how the groups differ in the
components
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>S</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">|</mo></mrow></mrow><annotation encoding="application/x-tex">log | S_i |</annotation></semantics></math>)
that go into Box’s M test.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diab.boxm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://friendly.github.io/heplots/reference/boxM.html" class="external-link">boxM</a></span><span class="op">(</span><span class="va">Diabetes</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="va">Diabetes</span><span class="op">$</span><span class="va">group</span><span class="op">)</span></span>
<span><span class="va">diab.boxm</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Box's M-test for Homogeneity of Covariance Matrices</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  Diabetes[, 2:5]</span></span>
<span><span class="co">## Chi-Sq (approx.) = 383, df = 20, p-value &lt;2e-16</span></span>
<span></span>
<span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">diab.boxm</span>, cex.lab<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="diabetes_files/figure-html/boxm-1.png" width="672" style="display: block; margin: auto;"></p>
<p>The log determinants are ordered according to the sizes of the data
ellipses we saw in the covariance ellipse plots.</p>
</div>
</div>
<div class="section level2">
<h2 id="fit-the-mlm">Fit the MLM<a class="anchor" aria-label="anchor" href="#fit-the-mlm"></a>
</h2>
<p>We ignore this problem for the sake of this example, and proceed to
fit the MANOVA model for the mean differences among groups.</p>
<p>The MANOVA shows a highly significant effect of <code>group</code> on
the collection of response variables.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diab.mlm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">glufast</span>, <span class="va">glutest</span>, <span class="va">instest</span>, <span class="va">sspg</span><span class="op">)</span> <span class="op">~</span> <span class="va">group</span>, data<span class="op">=</span><span class="va">Diabetes</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html" class="external-link">Anova</a></span><span class="op">(</span><span class="va">diab.mlm</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Type II MANOVA Tests: Pillai test statistic</span></span>
<span><span class="co">##       Df test stat approx F num Df den Df Pr(&gt;F)    </span></span>
<span><span class="co">## group  2      1.18     50.1      8    280 &lt;2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<div class="section level3">
<h3 id="examine-residuals-in-a-qq-plot">Examine residuals in a QQ plot<a class="anchor" aria-label="anchor" href="#examine-residuals-in-a-qq-plot"></a>
</h3>
<p>Another assumption of MANOVA is that the residuals have a
multivariate normal distribution. This can be assessed visually with a
Chi-square QQ plot. This plots squared Mahalanobis distances
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>D</mi><mn>2</mn></msup><annotation encoding="application/x-tex">D^2</annotation></semantics></math>)
of the residuals vs. corresponding quantiles of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>χ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\chi^2</annotation></semantics></math>
distribution with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
degrees of freedom. The <code>cqplot</code> function in the
<code>heplots</code> package is designed to do this from a fitted MLM
object. A confidence envelope makes it easy to see when the departure is
large enough to cause concern.</p>
<p>It can be seen here that the points differ substantially from the red
line of equality. There are far too many points with large
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>D</mi><mn>2</mn></msup><annotation encoding="application/x-tex">D^2</annotation></semantics></math>
values.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://friendly.github.io/heplots/reference/cqplot.html" class="external-link">cqplot</a></span><span class="op">(</span><span class="va">diab.mlm</span>, id.n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="diabetes_files/figure-html/cqplot-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="he-plots">HE plots<a class="anchor" aria-label="anchor" href="#he-plots"></a>
</h2>
<p>An HE plot shows the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math>
ellipse for differences among means together with the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
ellipse for error. In the default scaling, such plots have the visual
property that a given effect in the MLM is significant (by Roy’s maximum
root test) <em>iff</em> the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math>
ellipse projects <strong>anywhere</strong> outside the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
ellipse.</p>
<p>By default, the first two response variables are plotted. The result
shows that the means on both <code>glufast</code> and
<code>glutest</code> are ordered
<code>Normal &lt; Chemical &lt; Overt</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://friendly.github.io/heplots/reference/heplot.html" class="external-link">heplot</a></span><span class="op">(</span><span class="va">diab.mlm</span>, fill<span class="op">=</span><span class="cn">TRUE</span>, fill.alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p><img src="diabetes_files/figure-html/he1-1.png" width="576" style="display: block; margin: auto;"></p>
<p>The <code>pairs</code> method for an MLM gives a scatterplot matrix
of HE plots for all pairs of response variables. The pattern for
<code>instest</code> seems to differ from the other variables.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs</a></span><span class="op">(</span><span class="va">diab.mlm</span>, fill<span class="op">=</span><span class="cn">TRUE</span>, fill.alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p><img src="diabetes_files/figure-html/he2-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="canonical-discriminant-analysis">Canonical discriminant analysis<a class="anchor" aria-label="anchor" href="#canonical-discriminant-analysis"></a>
</h2>
<p>Canonical discriminant analysis effectively projects the data into
the space of linear combinations of the responses that accounts for the
greatest proportion of the between-group variance relative to
within-group variance.</p>
<p>In this case, with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">g=3</annotation></semantics></math>
groups, this space is two-dimensional, so all differences can be seen in
a 2D plot. From the output below, nearly 90% of between-group mean
differences are accounted for by the first canonical dimension. Both
canonical dimensions are significant, by a likelihood ratio stepdown
test.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diab.can</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/candisc.html">candisc</a></span><span class="op">(</span><span class="va">diab.mlm</span><span class="op">)</span></span>
<span><span class="va">diab.can</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Canonical Discriminant Analysis for group:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   CanRsq Eigenvalue Difference Percent Cumulative</span></span>
<span><span class="co">## 1  0.824      4.689       4.14    89.6       89.6</span></span>
<span><span class="co">## 2  0.353      0.546       4.14    10.4      100.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Test of H0: The canonical correlations in the </span></span>
<span><span class="co">## current row and all that follow are zero</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   LR test stat approx F numDF denDF Pr(&gt; F)    </span></span>
<span><span class="co">## 1        0.114     68.3     8   278 &lt; 2e-16 ***</span></span>
<span><span class="co">## 2        0.647     25.5     3   140 3.3e-13 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<div class="section level3">
<h3 id="canonical-discriminant-plot">Canonical discriminant plot<a class="anchor" aria-label="anchor" href="#canonical-discriminant-plot"></a>
</h3>
<p>The <code>plot</code> method for a <code>candisc</code> object plots
the scores on the canonical dimensions and overlays 60% data ellipses
for each group. The positions of the group means show the the means on
the canonical dimensions.</p>
<p>The relationship of the response variables to the canonical
dimensions is shown by vectors (similar to a biplot). Each vector is
defined by the correlations (structure coefficients) it has with the
canonical dimensions.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;The structure coefficients determine only the angle of
the vector with respect to the coordinate axes. The vectors are all
multiplied by a scale factor, chosen so the vectors nearly fill the plot
frame.&lt;/p&gt;"><sup>1</sup></a></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">diab.can</span>, ellipse<span class="op">=</span><span class="cn">TRUE</span>, var.lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="diabetes_files/figure-html/diab-can-plot-1.png" width="576" style="display: block; margin: auto;"></p>
<p>In this plot it can be seen that:</p>
<ul>
<li><p>Dimension 1 is highly related to <code>glufast</code>,
<code>glutest</code> and <code>sspg</code>, and the groups are ordered
<code>Normal &lt; Chemical &lt; Overt</code>.</p></li>
<li><p>Dimension 2 distinguishes the <code>Chemical_Diabetic</code>
group from the other two. This dimension is largely related to
<code>instest</code>, the plasma insulin during test. This confirms what
we saw in the HE plot matrix for all the responses.</p></li>
<li><p>The relative sizes of the data ellipses for the canonical scores
is another visual indication of the lack of heterogeneity of
variances.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="canonical-he-plot">Canonical HE plot<a class="anchor" aria-label="anchor" href="#canonical-he-plot"></a>
</h3>
<p>The <code>heplot</code> method for <code>candisc</code> objects gives
an HE plot summary of the canonical discriminant analysis. The variable
vectors are the same as in the canonical structure plot. The size of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math>
ellipse relative to that of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
ellipse is an indication of the magnitude of the multivariate effect for
<code>group</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://friendly.github.io/heplots/reference/heplot.html" class="external-link">heplot</a></span><span class="op">(</span><span class="va">diab.can</span>, fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, fill.alpha<span class="op">=</span><span class="fl">0.1</span>, var.lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="diabetes_files/figure-html/diab-heplot,%20-1.png" width="576" style="display: block; margin: auto;"></p>
<pre><code><span><span class="co">## Vector scale factor set to  12.06</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="other-analyses">Other analyses<a class="anchor" aria-label="anchor" href="#other-analyses"></a>
</h2>
<p>There are other methods that could be used to analyze these data and
display the results visually. We merely sketch some alternatives
here.</p>
<div class="section level3">
<h3 id="linear-and-quadratic-discriminant-analysis">Linear and quadratic discriminant analysis<a class="anchor" aria-label="anchor" href="#linear-and-quadratic-discriminant-analysis"></a>
</h3>
<p>Linear discriminant analysis (LDA) is similar in spirit to MANOVA,
but the emphasis is on classification rather than on testing differences
among means. As well, LDA allows specification of the prior
probabilities of group membership to make classification error rates
comparable to what would be obtained in a population of interest.
Quadratic discriminant analysis allows for differences in the covariance
matrices among groups, and gives quadratic rather then linear
classification boundaries.</p>
<p>LDA is in some sense equivalent to our canonical discriminant
analysis. A simple function for this is <code>lda</code> in the
<code>MASS</code> package. This gives the same class means and the same
variance proportions as <code>candisc</code>. However, here, the prior
probabilities are taken from the proportions of the groups in the
data.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="va">diab.lda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lda.html" class="external-link">lda</a></span><span class="op">(</span><span class="va">group</span> <span class="op">~</span> <span class="va">glufast</span> <span class="op">+</span> <span class="va">glutest</span> <span class="op">+</span> <span class="va">instest</span> <span class="op">+</span> <span class="va">sspg</span>, data <span class="op">=</span> <span class="va">Diabetes</span><span class="op">)</span></span>
<span><span class="va">diab.lda</span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lda(group ~ glufast + glutest + instest + sspg, data = Diabetes)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Prior probabilities of groups:</span></span>
<span><span class="co">##            Normal Chemical_Diabetic    Overt_Diabetic </span></span>
<span><span class="co">##            0.5241            0.2483            0.2276 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Group means:</span></span>
<span><span class="co">##                   glufast glutest instest  sspg</span></span>
<span><span class="co">## Normal              91.18   350.0   172.6 114.0</span></span>
<span><span class="co">## Chemical_Diabetic   99.31   493.9   288.0 209.0</span></span>
<span><span class="co">## Overt_Diabetic     217.67  1043.8   106.0 318.9</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients of linear discriminants:</span></span>
<span><span class="co">##                LD1       LD2</span></span>
<span><span class="co">## glufast  0.0326457 -0.038928</span></span>
<span><span class="co">## glutest -0.0119958  0.006560</span></span>
<span><span class="co">## instest  0.0003149  0.006202</span></span>
<span><span class="co">## sspg    -0.0056269  0.003231</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Proportion of trace:</span></span>
<span><span class="co">##    LD1    LD2 </span></span>
<span><span class="co">## 0.8958 0.1042</span></span></code></pre></div>
<p>From the LDA perspective, one goal in visualizing the results is to
see the boundaries of classification based on the <code>LD1</code> and
<code>LD2</code> scores. The plot shown here was produced with
<code>ggplot2</code>, following a method described in <a href="https://stackoverflow.com/questions/31893423/r-plotting-posterior-classification-probabilities-of-a-linear-discriminant-anal" class="external-link">this
stackoverflow question</a>. What is missing here is any indication of
how this relates to the response variables.</p>
<div class="float">
<img src="diabetes-lda.png" alt="LDA classification for the diabetes data"><div class="figcaption">LDA classification for the diabetes data</div>
</div>
<p>Quadratic discriminant analysis can be carried out in a similar way,
using the <code>qda</code> function. The results are not shown.</p>
</div>
<div class="section level3">
<h3 id="recursive-partitioning">Recursive partitioning<a class="anchor" aria-label="anchor" href="#recursive-partitioning"></a>
</h3>
<p>Recursive partitioning is a method that creates a decision tree
designed to classify the members of a population. It recursively splits
the data into sub-populations using dichotomous intervals of the
predictors. One strength of the method is that it is nicely tied to
<em>cross-validation</em>, where a sample is repeatedly split into
training and test samples, and the model fit to each training sample is
assessed on the test sample.</p>
<p>For the diabetes data, the result is very simple: A value of
<code>glutest &lt; 420</code> distinguishes normals from the two
clinical groups. For the latter, <code>glufast &lt; 117</code>
classifies an individual as chemical diabetic rather than overt
diabetic.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bethatkinson/rpart" class="external-link">rpart</a></span><span class="op">)</span></span>
<span><span class="va">diab.part</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart</a></span><span class="op">(</span><span class="va">group</span> <span class="op">~</span> <span class="va">glufast</span> <span class="op">+</span> <span class="va">glutest</span> <span class="op">+</span> <span class="va">instest</span> <span class="op">+</span> <span class="va">sspg</span>, data<span class="op">=</span><span class="va">Diabetes</span><span class="op">)</span></span>
<span><span class="va">diab.part</span></span>
<span><span class="co">## n= 145 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## node), split, n, loss, yval, (yprob)</span></span>
<span><span class="co">##       * denotes terminal node</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 1) root 145 69 Normal (0.52414 0.24828 0.22759)  </span></span>
<span><span class="co">##   2) glutest&lt; 420.5 76  1 Normal (0.98684 0.01316 0.00000) *</span></span>
<span><span class="co">##   3) glutest&gt;=420.5 69 34 Chemical_Diabetic (0.01449 0.50725 0.47826)  </span></span>
<span><span class="co">##     6) glufast&lt; 117 36  1 Chemical_Diabetic (0.02778 0.97222 0.00000) *</span></span>
<span><span class="co">##     7) glufast&gt;=117 33  0 Overt_Diabetic (0.00000 0.00000 1.00000) *</span></span></code></pre></div>
<p>A nice plot of the partition tree is produced using the
<code>rpart.plot</code> package. The numbers in the nodes give the
proportions classified in each of the three groups.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.milbo.org/rpart-plot/index.html" class="external-link">rpart.plot</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html" class="external-link">rpart.plot</a></span><span class="op">(</span><span class="va">diab.part</span>, box.palette<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Blues"</span>, <span class="st">"Reds"</span>,  <span class="st">"Greens"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="diabetes-rpart.png" alt="Recursive partition tree for diabetes data"><div class="figcaption">Recursive partition tree for diabetes data</div>
</div>
<p>How well does that do? We can examine a table of predicted group
membership vs. actual and calculate the error rate. Not too bad!</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">class.pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span>predicted<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">diab.part</span>, type<span class="op">=</span><span class="st">"class"</span><span class="op">)</span>, actual<span class="op">=</span><span class="va">Diabetes</span><span class="op">$</span><span class="va">group</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##                    actual</span></span>
<span><span class="co">## predicted           Normal Chemical_Diabetic Overt_Diabetic</span></span>
<span><span class="co">##   Normal                75                 1              0</span></span>
<span><span class="co">##   Chemical_Diabetic      1                35              0</span></span>
<span><span class="co">##   Overt_Diabetic         0                 0             33</span></span>
<span></span>
<span><span class="co"># error rate</span></span>
<span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">class.pred</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">class.pred</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.01379</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Friendly, M. &amp; Sigal, M. (2017) Visualizing Tests of Equality of
Covariance Matrices. Submitted for publication. </p>
<p>Reaven, G. M. &amp; Miller, R. G. (1979). An Attempt to Define the
Nature of Chemical Diabetes Using a Multidimensional Analysis
<em>Diabetologia</em>, <strong>16</strong>, 17-24.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Friendly, John Fox.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
